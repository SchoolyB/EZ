/*
 * Test: Bug #5 - Array return type mismatch
 * Testing out parameter pattern as workaround
 */

import @std, @arrays

using std

const Item struct {
    id int
    name string
}

/* Out parameter pattern for int arrays */
do filter_nums_out(nums [int], min int, result [int]) {
    for_each n in nums {
        if n >= min {
            arrays.append(result, n)
        }
    }
}

/* Out parameter pattern for struct arrays */
do filter_items_out(items [Item], min_id int, result [Item]) {
    for_each item in items {
        if item.id >= min_id {
            arrays.append(result, item)
        }
    }
}

do main() {
    println("=== Bug #5 Workaround: Out Parameter Pattern ===")
    println("")

    /* Test 1: Out parameter with int array */
    println("Test 1: Out parameter with [int]")
    temp nums [int] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
    temp filtered_nums [int] = {}
    filter_nums_out(nums, 5, filtered_nums)
    println("  Original: {1,2,3,4,5,6,7,8,9,10}")
    println("  Filtered (>=5): ${filtered_nums}")
    println("")

    /* Test 2: Out parameter with struct array */
    println("Test 2: Out parameter with [Item]")
    temp items [Item] = {}
    arrays.append(items, Item{id: 1, name: "One"})
    arrays.append(items, Item{id: 2, name: "Two"})
    arrays.append(items, Item{id: 3, name: "Three"})

    temp filtered_items [Item] = {}
    filter_items_out(items, 2, filtered_items)
    println("  Filtered items (id >= 2):")
    for_each item in filtered_items {
        println("    - #${item.id}: ${item.name}")
    }

    println("")
    println("=== Test Complete ===")
}
