/*
 * control-flow.ez - Test control flow (if/or/otherwise, for, while, for_each, range)
 */

import @std
using std

do main() {
    println("=== Control Flow Test ===")
    temp passed int = 0
    temp failed int = 0

    // ==================== IF/OR/OTHERWISE ====================
    println("  -- if/or/otherwise --")

    // Test 1: Simple if
    temp val int = 15
    temp result string = ""
    if val < 10 {
        result = "small"
    } or val < 20 {
        result = "medium"
    } otherwise {
        result = "large"
    }
    if result == "medium" {
        println("  [PASS] if/or/otherwise chain")
        passed += 1
    } otherwise {
        println("  [FAIL] if/or/otherwise: expected 'medium', got '${result}'")
        failed += 1
    }

    // Test 2: if with parentheses
    temp result2 string = ""
    if (val < 10) {
        result2 = "small"
    } or (val < 20) {
        result2 = "medium"
    } otherwise {
        result2 = "large"
    }
    if result2 == "medium" {
        println("  [PASS] if/or/otherwise with parentheses")
        passed += 1
    } otherwise {
        println("  [FAIL] if/or/otherwise with parentheses: expected 'medium', got '${result2}'")
        failed += 1
    }

    // ==================== FOR LOOP ====================
    println("  -- for loop --")

    // Test 3: for with range
    temp sum int = 0
    for i in range(0, 5) {
        sum += i
    }
    if sum == 10 {
        println("  [PASS] for i in range(0, 5) sums to 10")
        passed += 1
    } otherwise {
        println("  [FAIL] for i in range(0, 5): expected sum 10, got ${sum}")
        failed += 1
    }

    // Test 4: for with parentheses
    temp sum2 int = 0
    for (i in range(0, 5)) {
        sum2 += i
    }
    if sum2 == 10 {
        println("  [PASS] for (i in range(0, 5)) with parens")
        passed += 1
    } otherwise {
        println("  [FAIL] for with parens: expected sum 10, got ${sum2}")
        failed += 1
    }

    // Note: Descending range like range(5, 0) is now a check-time error (E9005)
    // Use a for loop with decrement if you need to count backwards

    // Test 5: for with type annotation
    temp sum3 int = 0
    for i int in range(0, 3) {
        sum3 += i
    }
    if sum3 == 3 {
        println("  [PASS] for with type annotation")
        passed += 1
    } otherwise {
        println("  [FAIL] for with type annotation: expected 3, got ${sum3}")
        failed += 1
    }

    // ==================== AS_LONG_AS (WHILE) ====================
    println("  -- as_long_as (while) --")

    // Test 7: as_long_as basic
    temp w int = 0
    as_long_as w < 3 {
        w += 1
    }
    if w == 3 {
        println("  [PASS] as_long_as w < 3")
        passed += 1
    } otherwise {
        println("  [FAIL] as_long_as: expected 3, got ${w}")
        failed += 1
    }

    // Test 8: as_long_as with parentheses
    temp w2 int = 0
    as_long_as (w2 < 3) {
        w2 += 1
    }
    if w2 == 3 {
        println("  [PASS] as_long_as with parentheses")
        passed += 1
    } otherwise {
        println("  [FAIL] as_long_as with parens: expected 3, got ${w2}")
        failed += 1
    }

    // ==================== FOR_EACH ====================
    println("  -- for_each --")

    // Test 9: for_each basic
    temp items [string] = {"a", "b", "c"}
    temp concat string = ""
    for_each item in items {
        concat = "${concat}${item}"
    }
    if concat == "abc" {
        println("  [PASS] for_each concatenation")
        passed += 1
    } otherwise {
        println("  [FAIL] for_each: expected 'abc', got '${concat}'")
        failed += 1
    }

    // Test 10: for_each with parentheses
    temp concat2 string = ""
    for_each (item in items) {
        concat2 = "${concat2}${item}"
    }
    if concat2 == "abc" {
        println("  [PASS] for_each with parentheses")
        passed += 1
    } otherwise {
        println("  [FAIL] for_each with parens: expected 'abc', got '${concat2}'")
        failed += 1
    }

    // ==================== BREAK ====================
    println("  -- break --")

    // Test 11: break in for loop
    temp break_sum int = 0
    for i in range(0, 10) {
        if i == 3 {
            break
        }
        break_sum += i
    }
    if break_sum == 3 {
        println("  [PASS] break at i=3 gives sum 3")
        passed += 1
    } otherwise {
        println("  [FAIL] break: expected sum 3 (0+1+2), got ${break_sum}")
        failed += 1
    }

    // Test 12: break in as_long_as
    temp break_count int = 0
    as_long_as (break_count < 100) {
        if (break_count == 5) {
            break
        }
        break_count += 1
    }
    if break_count == 5 {
        println("  [PASS] break in as_long_as at 5")
        passed += 1
    } otherwise {
        println("  [FAIL] break in as_long_as: expected 5, got ${break_count}")
        failed += 1
    }

    // ==================== CONTINUE ====================
    println("  -- continue --")

    // Test 13: continue in for loop
    temp cont_sum int = 0
    for i in range(0, 5) {
        if i == 2 {
            continue
        }
        cont_sum += i
    }
    if cont_sum == 8 {
        println("  [PASS] continue skips i=2, sum = 8")
        passed += 1
    } otherwise {
        println("  [FAIL] continue: expected sum 8 (0+1+3+4), got ${cont_sum}")
        failed += 1
    }

    // Test 14: continue in for_each
    temp nums [int] = {1, 2, 3, 4, 5}
    temp skip_sum int = 0
    for_each (n in nums) {
        if (n == 3) {
            continue
        }
        skip_sum += n
    }
    if skip_sum == 12 {
        println("  [PASS] continue in for_each skips 3")
        passed += 1
    } otherwise {
        println("  [FAIL] continue in for_each: expected 12 (1+2+4+5), got ${skip_sum}")
        failed += 1
    }

    // ==================== NESTED ====================
    println("  -- nested loops --")

    // Test 15: nested for loops
    temp nested_sum int = 0
    for (i in range(0, 3)) {
        for (j in range(0, 2)) {
            nested_sum += 1
        }
    }
    if nested_sum == 6 {
        println("  [PASS] nested for loops 3x2 = 6")
        passed += 1
    } otherwise {
        println("  [FAIL] nested loops: expected 6, got ${nested_sum}")
        failed += 1
    }

    // Test 16: for with if inside
    temp even_sum int = 0
    for (i in range(0, 6)) {
        if (i % 2 == 0) {
            even_sum += i
        }
    }
    if even_sum == 6 {
        println("  [PASS] for with if: even sum 0+2+4 = 6")
        passed += 1
    } otherwise {
        println("  [FAIL] for with if: expected 6, got ${even_sum}")
        failed += 1
    }

    // Summary
    println("")
    println("Results: ${passed} passed, ${failed} failed")

    if failed > 0 {
        println("SOME TESTS FAILED")
    } otherwise {
        println("ALL TESTS PASSED")
    }
}
