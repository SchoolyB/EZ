/*
 * mutability_sync.ez - Test temp/const mutability sync
 *
 * Tests that:
 * - temp variables have mutable values (can modify arrays, maps, structs)
 * - const variables have immutable values
 * - temp/const overrides stdlib return value mutability
 */

import @std, @arrays
using std

const Person struct {
    name string
    age int
}

do get_array() -> [int] {
    return {1, 2, 3}
}

do get_person() -> Person {
    return Person{name: "Alice", age: 30}
}

do main() {
    println("=== Mutability Sync Tests ===")
    temp passed int = 0
    temp failed int = 0

    // Test 1: temp array from function is mutable
    temp arr1 [int] = get_array()
    arrays.append(arr1, 4)
    if len(arr1) == 4 && arr1[3] == 4 {
        println("  [PASS] temp array from function is mutable")
        passed += 1
    } otherwise {
        println("  [FAIL] temp array should be mutable")
        failed += 1
    }

    // Test 2: temp array literal is mutable
    temp arr2 [int] = {10, 20, 30}
    arrays.append(arr2, 40)
    if len(arr2) == 4 {
        println("  [PASS] temp array literal is mutable")
        passed += 1
    } otherwise {
        println("  [FAIL] temp array literal should be mutable")
        failed += 1
    }

    // Test 3: temp struct is mutable
    temp p1 = get_person()
    p1.name = "Bob"
    if p1.name == "Bob" {
        println("  [PASS] temp struct from function is mutable")
        passed += 1
    } otherwise {
        println("  [FAIL] temp struct should be mutable")
        failed += 1
    }

    // Test 4: temp map is mutable
    temp m1 map[string:int] = {"a": 1}
    m1["b"] = 2
    if m1["b"] == 2 {
        println("  [PASS] temp map is mutable")
        passed += 1
    } otherwise {
        println("  [FAIL] temp map should be mutable")
        failed += 1
    }

    // Test 5: copy() creates mutable copy
    temp arr3 [int] = {1, 2, 3}
    temp arr4 [int] = copy(arr3)
    arrays.append(arr4, 4)
    if len(arr4) == 4 && len(arr3) == 3 {
        println("  [PASS] copy() creates independent mutable copy")
        passed += 1
    } otherwise {
        println("  [FAIL] copy() should create mutable copy")
        failed += 1
    }

    // Summary
    println("")
    println("Results: ${passed} passed, ${failed} failed")
    if failed > 0 {
        println("SOME TESTS FAILED")
    } otherwise {
        println("ALL TESTS PASSED")
    }
}
