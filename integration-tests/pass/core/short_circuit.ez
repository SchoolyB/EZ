/*
 * short_circuit.ez - Test short-circuit evaluation of && and ||
 */

import @std
using std

temp side_effect_count int = 0

do side_effect() -> bool {
    side_effect_count++
    return true
}

do main() {
    println("=== Short-Circuit Evaluation Test ===")
    temp passed int = 0
    temp failed int = 0

    // Test 1: && short-circuits on false (right side NOT evaluated)
    side_effect_count = 0
    if false && side_effect() {
        // unreachable
    }
    if side_effect_count == 0 {
        println("  [PASS] false && fn(): right side not evaluated")
        passed += 1
    } otherwise {
        println("  [FAIL] false && fn(): right side was evaluated ${side_effect_count} time(s)")
        failed += 1
    }

    // Test 2: && evaluates right side when left is true
    side_effect_count = 0
    if true && side_effect() {
        // expected path
    }
    if side_effect_count == 1 {
        println("  [PASS] true && fn(): right side evaluated once")
        passed += 1
    } otherwise {
        println("  [FAIL] true && fn(): expected 1 call, got ${side_effect_count}")
        failed += 1
    }

    // Test 3: || short-circuits on true (right side NOT evaluated)
    side_effect_count = 0
    if true || side_effect() {
        // expected path
    }
    if side_effect_count == 0 {
        println("  [PASS] true || fn(): right side not evaluated")
        passed += 1
    } otherwise {
        println("  [FAIL] true || fn(): right side was evaluated ${side_effect_count} time(s)")
        failed += 1
    }

    // Test 4: || evaluates right side when left is false
    side_effect_count = 0
    if false || side_effect() {
        // expected path
    }
    if side_effect_count == 1 {
        println("  [PASS] false || fn(): right side evaluated once")
        passed += 1
    } otherwise {
        println("  [FAIL] false || fn(): expected 1 call, got ${side_effect_count}")
        failed += 1
    }

    println("")
    println("Results: ${passed} passed, ${failed} failed")

    if failed > 0 {
        println("SOME TESTS FAILED")
    } otherwise {
        println("ALL TESTS PASSED")
    }
}
