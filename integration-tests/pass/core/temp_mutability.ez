/*
 * temp_mutability.ez - Test that temp automatically makes function returns mutable
 */

import @std, @arrays
using std, arrays

do get_numbers() -> [int] {
    return {1, 2, 3}
}

do get_point() -> (int, int) {
    return 10, 20
}

do main() {
    println("=== Temp Mutability Test ===")
    temp passed int = 0
    temp failed int = 0

    // Test 1: temp from function return is mutable (can modify elements)
    temp arr = get_numbers()
    arr[0] = 99
    if arr[0] == 99 {
        println("  [PASS] temp arr from fn return: arr[0] = 99 (mutable)")
        passed += 1
    } otherwise {
        println("  [FAIL] temp arr from fn return: expected arr[0] = 99, got ${arr[0]}")
        failed += 1
    }

    // Test 2: temp from function return can be appended to
    arrays.append(arr, 4)
    if len(arr) == 4 {
        println("  [PASS] temp arr from fn return: append works, len = 4")
        passed += 1
    } otherwise {
        println("  [FAIL] temp arr from fn return: expected len 4, got ${len(arr)}")
        failed += 1
    }

    // Test 3: temp from function return can be reassigned
    arr = {10, 20}
    if len(arr) == 2 {
        println("  [PASS] temp arr reassigned: len = 2")
        passed += 1
    } otherwise {
        println("  [FAIL] temp arr reassigned: expected len 2, got ${len(arr)}")
        failed += 1
    }

    // Test 4: temp from multi-return is mutable
    temp x, y = get_point()
    x = x + 5
    y = y + 10
    if x == 15 && y == 30 {
        println("  [PASS] temp from multi-return: x = 15, y = 30 (mutable)")
        passed += 1
    } otherwise {
        println("  [FAIL] temp from multi-return: expected 15,30, got ${x},${y}")
        failed += 1
    }

    // Test 5: temp from array literal is mutable
    temp lit = {1, 2, 3}
    lit[0] = 100
    if lit[0] == 100 {
        println("  [PASS] temp array literal: lit[0] = 100 (mutable)")
        passed += 1
    } otherwise {
        println("  [FAIL] temp array literal: expected 100, got ${lit[0]}")
        failed += 1
    }

    println("")
    println("Results: ${passed} passed, ${failed} failed")

    if failed > 0 {
        println("SOME TESTS FAILED")
    } otherwise {
        println("ALL TESTS PASSED")
    }
}
