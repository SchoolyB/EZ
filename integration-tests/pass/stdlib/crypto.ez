/*
 * crypto.ez - Test @crypto standard library
 */

import @std, @crypto, @strings
using std

do main() {
    println("=== @crypto Standard Library Test ===")
    temp passed int = 0
    temp failed int = 0

    // ==================== crypto.sha256 ====================
    println("  -- crypto.sha256 --")

    // Test 1: sha256 produces 64 hex characters
    temp hash256 string = crypto.sha256("hello")
    if len(hash256) == 64 {
        println("  [PASS] crypto.sha256() returns 64 hex chars")
        passed += 1
    } otherwise {
        println("  [FAIL] crypto.sha256(): expected 64 chars, got ${len(hash256)}")
        failed += 1
    }

    // Test 2: sha256 is deterministic
    temp hash256b string = crypto.sha256("hello")
    if hash256 == hash256b {
        println("  [PASS] crypto.sha256() is deterministic")
        passed += 1
    } otherwise {
        println("  [FAIL] crypto.sha256() not deterministic")
        failed += 1
    }

    // Test 3: different input produces different hash
    temp hash256c string = crypto.sha256("world")
    if hash256 != hash256c {
        println("  [PASS] crypto.sha256() different input -> different hash")
        passed += 1
    } otherwise {
        println("  [FAIL] crypto.sha256() collision")
        failed += 1
    }

    // ==================== crypto.sha512 ====================
    println("  -- crypto.sha512 --")

    // Test 4: sha512 produces 128 hex characters
    temp hash512 string = crypto.sha512("hello")
    if len(hash512) == 128 {
        println("  [PASS] crypto.sha512() returns 128 hex chars")
        passed += 1
    } otherwise {
        println("  [FAIL] crypto.sha512(): expected 128 chars, got ${len(hash512)}")
        failed += 1
    }

    // ==================== crypto.md5 ====================
    println("  -- crypto.md5 --")

    // Test 5: md5 produces 32 hex characters
    temp hash_md5 string = crypto.md5("hello")
    if len(hash_md5) == 32 {
        println("  [PASS] crypto.md5() returns 32 hex chars")
        passed += 1
    } otherwise {
        println("  [FAIL] crypto.md5(): expected 32 chars, got ${len(hash_md5)}")
        failed += 1
    }

    // ==================== crypto.random_bytes ====================
    println("  -- crypto.random_bytes --")

    // Test 6: random_bytes returns correct length
    temp bytes [byte] = crypto.random_bytes(16)
    if len(bytes) == 16 {
        println("  [PASS] crypto.random_bytes(16) returns 16 bytes")
        passed += 1
    } otherwise {
        println("  [FAIL] crypto.random_bytes(16): got ${len(bytes)} bytes")
        failed += 1
    }

    // ==================== crypto.random_hex ====================
    println("  -- crypto.random_hex --")

    // Test 7: random_hex returns correct length
    temp hex_str string = crypto.random_hex(16)
    if len(hex_str) == 32 {
        println("  [PASS] crypto.random_hex(16) returns 32 hex chars")
        passed += 1
    } otherwise {
        println("  [FAIL] crypto.random_hex(16): got ${len(hex_str)} chars")
        failed += 1
    }

    // Test 8: random_hex produces different values
    temp hex_str2 string = crypto.random_hex(16)
    if hex_str != hex_str2 {
        println("  [PASS] crypto.random_hex() produces unique values")
        passed += 1
    } otherwise {
        println("  [FAIL] crypto.random_hex() produced same value twice")
        failed += 1
    }

    // Summary
    println("")
    println("Results: ${passed} passed, ${failed} failed")

    if failed > 0 {
        println("SOME TESTS FAILED")
    } otherwise {
        println("ALL TESTS PASSED")
    }
}
