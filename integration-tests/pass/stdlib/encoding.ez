/*
 * encoding.ez - Test encoding module functions
 */

import @std
import @encoding
using std

do main() {
    println("=== Encoding Module Test ===")
    temp passed int = 0
    temp failed int = 0

    // ==================== BASE64 ====================
    println("  -- base64 --")

    // Test 1: base64 encode
    temp b64_encoded string = encoding.base64_encode("Hello, World!")
    if b64_encoded == "SGVsbG8sIFdvcmxkIQ==" {
        println("  [PASS] base64_encode('Hello, World!')")
        passed += 1
    } otherwise {
        println("  [FAIL] base64_encode: expected 'SGVsbG8sIFdvcmxkIQ==', got '${b64_encoded}'")
        failed += 1
    }

    // Test 2: base64 decode
    temp b64_decoded, b64_err = encoding.base64_decode("SGVsbG8sIFdvcmxkIQ==")
    if b64_err == nil {
        if b64_decoded == "Hello, World!" {
            println("  [PASS] base64_decode() decodes correctly")
            passed += 1
        } otherwise {
            println("  [FAIL] base64_decode: expected 'Hello, World!', got '${b64_decoded}'")
            failed += 1
        }
    } otherwise {
        println("  [FAIL] base64_decode: unexpected error")
        failed += 1
    }

    // Test 3: base64 decode invalid
    temp _, b64_bad_err = encoding.base64_decode("not valid!!!")
    if b64_bad_err != nil {
        println("  [PASS] base64_decode() rejects invalid input")
        passed += 1
    } otherwise {
        println("  [FAIL] base64_decode: should reject invalid input")
        failed += 1
    }

    // ==================== HEX ====================
    println("  -- hex --")

    // Test 4: hex encode
    temp hex_encoded string = encoding.hex_encode("AB")
    if hex_encoded == "4142" {
        println("  [PASS] hex_encode('AB')")
        passed += 1
    } otherwise {
        println("  [FAIL] hex_encode: expected '4142', got '${hex_encoded}'")
        failed += 1
    }

    // Test 5: hex decode
    temp hex_decoded, hex_err = encoding.hex_decode("4142")
    if hex_err == nil {
        if hex_decoded == "AB" {
            println("  [PASS] hex_decode() decodes correctly")
            passed += 1
        } otherwise {
            println("  [FAIL] hex_decode: expected 'AB', got '${hex_decoded}'")
            failed += 1
        }
    } otherwise {
        println("  [FAIL] hex_decode: unexpected error")
        failed += 1
    }

    // Test 6: hex decode invalid
    temp _, hex_bad_err = encoding.hex_decode("ZZZZ")
    if hex_bad_err != nil {
        println("  [PASS] hex_decode() rejects invalid input")
        passed += 1
    } otherwise {
        println("  [FAIL] hex_decode: should reject invalid input")
        failed += 1
    }

    // ==================== URL ====================
    println("  -- url --")

    // Test 7: url encode
    temp url_encoded string = encoding.url_encode("hello world&foo=bar")
    if url_encoded == "hello+world%26foo%3Dbar" {
        println("  [PASS] url_encode('hello world&foo=bar')")
        passed += 1
    } otherwise {
        println("  [FAIL] url_encode: got '${url_encoded}'")
        failed += 1
    }

    // Test 8: url decode
    temp url_decoded, url_err = encoding.url_decode("hello+world%26foo%3Dbar")
    if url_err == nil {
        if url_decoded == "hello world&foo=bar" {
            println("  [PASS] url_decode() decodes correctly")
            passed += 1
        } otherwise {
            println("  [FAIL] url_decode: expected 'hello world&foo=bar', got '${url_decoded}'")
            failed += 1
        }
    } otherwise {
        println("  [FAIL] url_decode: unexpected error")
        failed += 1
    }

    // Test 9: url decode invalid
    temp _, url_bad_err = encoding.url_decode("%ZZ")
    if url_bad_err != nil {
        println("  [PASS] url_decode() rejects invalid input")
        passed += 1
    } otherwise {
        println("  [FAIL] url_decode: should reject invalid input")
        failed += 1
    }

    // Summary
    println("")
    println("Results: ${passed} passed, ${failed} failed")

    if failed > 0 {
        println("SOME TESTS FAILED")
    } otherwise {
        println("ALL TESTS PASSED")
    }
}
