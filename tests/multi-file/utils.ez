/*
 * utils.ez - Utility functions module
 *
 * Provides general-purpose utility functions.
 */

module utils

import @std
import @strings
import @math

using std

// ==================================================
// STRING UTILITIES
// ==================================================

/* truncate - Truncates string to max length with "..." */
/* NOTE: strings.slice not available - see BUG 12 - using manual loop */
do truncate(s string, max_len int) -> string {
    if len(s) <= max_len {
        return s
    }
    if max_len <= 3 {
        return "..."
    }
    temp cut int = max_len - 3
    temp result string = ""
    for i in range(0, cut) {
        result = "${result}${s[i]}"
    }
    return "${result}..."
}

/* pad_right - Pads string on the right to target length */
/* NOTE: strings.repeat not available - see BUG 9 - using manual loop */
do pad_right(s string, target_len int) -> string {
    temp current_len int = len(s)
    if current_len >= target_len {
        return s
    }
    temp result string = s
    temp padding int = target_len - current_len
    for i in range(0, padding) {
        result = "${result} "
    }
    return result
}

/* pad_left - Pads string on the left to target length */
/* NOTE: strings.repeat not available - see BUG 9 - using manual loop */
do pad_left(s string, target_len int) -> string {
    temp current_len int = len(s)
    if current_len >= target_len {
        return s
    }
    temp result string = ""
    temp padding int = target_len - current_len
    for i in range(0, padding) {
        result = "${result} "
    }
    return "${result}${s}"
}

/* is_empty - Checks if string is empty or whitespace only */
do is_empty(s string) -> bool {
    temp trimmed string = strings.trim(s)
    return len(trimmed) == 0
}

// ==================================================
// NUMBER UTILITIES
// ==================================================

/* clamp - Constrains value to range [min_val, max_val] */
do clamp(value int, min_val int, max_val int) -> int {
    if value < min_val {
        return min_val
    }
    if value > max_val {
        return max_val
    }
    return value
}

/* clamp_float - Float version of clamp */
do clamp_float(value float, min_val float, max_val float) -> float {
    if value < min_val {
        return min_val
    }
    if value > max_val {
        return max_val
    }
    return value
}

/* calculate_percentage - Calculates percentage with safety check */
do calculate_percentage(part int, total int) -> float {
    if total == 0 {
        return 0.0
    }
    return float(part) / float(total) * 100.0
}

/* min_int - Returns minimum of two integers */
do min_int(a int, b int) -> int {
    if a < b {
        return a
    }
    return b
}

/* max_int - Returns maximum of two integers */
do max_int(a int, b int) -> int {
    if a > b {
        return a
    }
    return b
}

// ==================================================
// ARRAY UTILITIES
// ==================================================

/* sum_array - Sums an array of integers */
do sum_array(arr [int]) -> int {
    temp total int = 0
    for_each n in arr {
        total += n
    }
    return total
}

/* average_array - Calculates average of integer array */
do average_array(arr [int]) -> float {
    if len(arr) == 0 {
        return 0.0
    }
    temp total int = sum_array(arr)
    return float(total) / float(len(arr))
}

/* contains_int - Checks if array contains value */
do contains_int(arr [int], target int) -> bool {
    for_each n in arr {
        if n == target {
            return true
        }
    }
    return false
}

/* contains_string - Checks if string array contains value */
do contains_string(arr [string], target string) -> bool {
    for_each s in arr {
        if s == target {
            return true
        }
    }
    return false
}
